# 文本编辑器中的学习

## 从 vscode 中学习到的

整体文本输入是一个行列的布局，每个字符为一列

记录行列信息的时候用了 32 位整数的方法，因为一行会有多个 span 的情况，每个字符的记录就是前十六位记录在哪个 span，后十六位记录在这个 span 的第几位

输入指针是一个`div`绘制的（难怪可以多指针）

点击某个区域后会 focus 到一个`textarea`后监听`input`事件和`composition`事件

因为整体布局不是`textarea`这么方便的东西，也不方便给所有字符加事件监听，利用的是`document.caretRangeFromPoint`

如果该行都是正常的字符则直接用半宽的字符作为单位计算宽度，否则利用浏览器的Range来计算，顺便缓存计算结果

## 从 contenteditable 中学习到的

回车会复制当前的**行 dom 结构**（也就是加 flex 的布局会有影响），并附加一个`<br>`元素占位

## 模仿 vscode 时了解到的

`window.getSelection`，获取当前指针或选区的信息。

监听指针位置可以用`selectionchange`事件

所有空格都用转义字符比较好

缩进因为动态添加了文字需要重新设置光标位置
